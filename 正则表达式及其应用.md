# 正则表达式及其应用

#### 介绍：

正则表达式（Regular Expression）是一种匹配字符串模式的概念。

正则表达式使用一个模式字符串来描述、匹配一系列匹配某个句法规则的字符串，通常用来搜索符合某个模式（规则）的字符串。

这一定义看起来比较复杂，”句法规则“这一说法也可能会让读者想到高中英语语法（对不起笔者全忘了）而感到”生涩“。但不用担心，我们从几个例子开始。

#### 日常使用的例子：

假如现在你是南京大学某个活动的主办方，你收集了所有参加这个活动的学生的学号，现在你想匹配出所有21级的学生；另外，你还从问卷中收集了所有人的邮箱，你现在知道其中哪些人的邮箱是有效邮箱。

如果用自然语言来描述21级学生学号的匹配模式，可以这么描述：**“一个由21开头，长度为9，每个字符都是数字的字符串”**。这个模式或许不太准确，但不是21级的学生一定不符合这个模式。

如果想找到所有的有效邮箱，可以这么描述：**“一个中间有@，前面是字母，数字和某些特定的字符，后面是一个域名，一般全是字母，比如qq.com，gmail.com之类的...”**

#### 计算机科学中的例子：

如果你想进行编程，有时你想匹配一个十六进制数，或者想匹配符合条件的url网址......

如果用自然语言来描述一个符合url网址的匹配模式（这个模式也或许不太准确，但’大概‘是准确的）：

**“一个由`https:/`/或https://开头，后面至少有一个'.'，每个点前后或之间都有一些字符，后面可以由/结尾，也可以在/之后加入若干个字符...”**

这一规则用自然语言描述的话，是很复杂的，我这里的描述也只是一个近似的描述。实际上，url的前缀还可以是其他的协议，可以有`www`也可以没有、后面的路径可能有多个`/`，这些都不是很好描述。

#### （万恶的）课程中的例子：

如果你是一个计算机系学生，有时你可能被迫使用到正则表达式。在万恶的计算机系统基础实验PA中，PA1要求你使用正则表达式鉴定每种token以进行句法匹配；你有时也要对某些语句进行特殊的操作，这些事情由人工做太复杂了。

#### 

我们到现在来回看定义：“正则表达式（Regular Expression）是一种匹配字符串模式的概念。正则表达式使用一个模式字符串来描述、匹配一系列匹配某个句法规则的字符串，通常用来搜索符合某个模式（规则）的字符串。”我们上面所有加粗的自然语言规则，就是为了达到“匹配符合某个句法规则的字符串”这一目的而进行的描述。

但自然语言很难描述其中的trick，这些“规则”有时用自然语言说明是复杂甚至无力的，所以必须要用某种更方便的语言来进行表示。实现这一需求所需要的工具就是正则表达式。下面，我们对进行展开

#### 普通字符和特殊字符

在正则表达式中分为普通字符和特殊字符。普通字符按照字面意义进行匹配，例如匹配字母 "a" 将匹配到文本中的 "a" 字符。

特殊字符具有特殊的含义，就像`printf`函数中`%d`，`%n`等描述符具有特殊的含义一样，或者是字符串中`"\0"`和`"\n"`。在正则表达式中， `\d` 匹配任意数字字符，`\w` 匹配任意字母数字字符，`./*/?`以不同的特点匹配不同的任意字符。

其中最常用的三个特殊字符是分别为`*`（匹配前面的模式零次或多次）；`+`（匹配前面的模式一次或多次）；`?`（匹配前面的模式零次或一次）。

因此，`21\d\d\d\d\d\d\d`匹配到的所有的学号都是21级的学生，这完美描述了之前提到的自然语言规则；或者说，`*.c`匹配所有以`.c`结尾的文件（无论文件名多少），因此我们可能会在shell里可以用`rm *.s`删除文件夹里所有以`.s`扩展名结尾的文件。

#### 括号字符：

正则表达式中可能会有三种括号：圆括号()，方括号[]，花括号{}，每种括号的意思各不相同。

括号`( )`用于分组和捕获子表达式。“子表达式”的概念是指一个整体，其中的匹配需要一起进行，比如说`(好)?(喜欢)*IT侠`可以匹配`”好喜欢IT侠“`，`”喜欢喜欢喜欢喜欢喜欢IT侠“`等。

此处应该配图，笔芯.jpg

方括号`[ ]`匹配括号内的任意一个字符。例如，`[abc]` 匹配字符 "a"、"b" 或 "c"。因此十六进制数可以表示为`[0-9a-f]+`。

圆括号`{n}`用来指定匹配次数。`{n}`匹配前面的模式恰好 n 次，`{n,}`匹配前面的模式至少 n 次，`{n,m}`匹配前面的模式至少 n 次且不超过 m 次。比如说，`你是(一个){3}*的NJU学生`可以匹配`你是一个一个一个可爱的NJU学生`。

#### 特殊字符：

`\`是转义字符，用于匹配特殊字符本身，如'\?'可以匹配问号；`.`匹配一个任意字符（除了换行符）；`|`：用于指定多个模式的选择，如`(TH|PK|NJ)U`可以匹配`THU`或`PKU`或`THU`。

#### 练习：

到这里的话，基本上最基础的正则表达式语法就已经全部涵盖完了。我们留下一些习题以供大家思考：

简单的练习：

ipv4地址的匹配：用自然语言描述的话，ipv4的地址可以被表示为`a.b.c.d`，其中`a,b,c,d`是取值在0至255之间的整数。

日期的匹配：请找到一个可以表示YYYY-MM-DD的日期的正则表达式，且仅有合法日期可以被表达。

密码正确性验证：假设某网站的密码只能包含数字或字母，至少为6位，最多为20位。请制定一个规则，使得它可以匹配所有正确的代码。

复杂的练习。

C语言变量命名规则：可以参考https://www.w3schools.com/c/c_variables.php

#### 题外话：

我们介绍了正则表达式的基础语法规则，但就这一次所说的内容来看，正则表达式似乎也没法表示很难的模式。此外，我们可以窥探一下正则表达式表达力的上限。

这一表达式可以表示大部分合法的url（https://stackoverflow.com/questions/161738/what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url）

```
/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/
```

这一表达式可以表示所有合法的邮箱地址（https://stackoverflow.com/questions/201323/how-can-i-validate-an-email-address-using-a-regular-expression）：

```
(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])
```

如果允许递归正则表达式的话，正则表达式还可以表示所有符合正则表达式规则的字符串（https://stackoverflow.com/questions/172303/is-there-a-regular-expression-to-detect-a-valid-regular-expression）：

```
/^((?:(?:[^?+*{}()[\]\\|]+|\\.|\[(?:\^?\\.|\^[^\\]|[^\\^])(?:[^\]\\]+|\\.)*\]|\((?:\?[:=!]|\?<[=!]|\?>)?(?1)??\)|\(\?(?:R|[+-]?\d+)\))(?:(?:[?+*]|\{\d+(?:,\d*)?\})[?+]?)?|\|)*)$/
```

以下是一些有用的网页：

https://regex101.com/ （正则表达式查询网站）

https://regexcrossword.com/ （正则表达式字谜，十分推荐！）

此处有图。

![a.txt](https://ibb.co/3vXzkBb)





就酱，我们之后再见！